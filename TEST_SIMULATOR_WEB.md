# 模拟器 + Web 端测试强制提醒功能

## 🎯 测试组合

- **设备A**：Android 模拟器 (Pixel_2) + Expo Go - 作为频道主
- **设备B**：Web 浏览器 (Chrome/Firefox) - 作为用户

## ✅ 优势

1. **无需多台物理设备**：只需一台电脑
2. **并行调试方便**：可以同时看到两个界面
3. **快速切换测试**：无需来回拿手机
4. **日志同步查看**：终端、模拟器、浏览器控制台

## 📋 详细测试步骤

### Step 1: 启动开发服务器

```bash
cd d:\wenjianjia2\channel-app
npx expo start --clear
```

等待看到：
```
Metro waiting on exp://192.168.x.x:8081
› Press w │ open web
```

### Step 2: 启动 Android 模拟器

```bash
# 另开一个终端
emulator -avd Pixel_2
```

等待模拟器完全启动（约1-2分钟）

### Step 3: 在模拟器中打开应用

**方法1：扫描二维码**
- 打开 Expo Go
- 点击 "Scan QR Code"
- 扫描终端显示的二维码

**方法2：手动输入**
- 打开 Expo Go
- 点击 "Enter URL manually"
- 输入终端显示的 URL（如：`exp://192.168.1.100:8081`）

### Step 4: 模拟器 - 创建频道主账号

```
用户名：频道主A
手机号：13800000001
密码：123456
```

1. 注册并登录
2. 进入"个人中心"
3. 点击"创建频道"
4. 填写信息：
   - 频道名称：`强提醒测试`
   - 描述：`Web端测试`
   - 分类：`科技`
5. 点击"创建"

### Step 5: 打开 Web 端

**在 Expo 终端按 `w` 键**，或直接访问 `http://localhost:8081`

浏览器会自动打开应用。

### Step 6: Web 端 - 创建用户账号

```
用户名：Web用户
手机号：13900000002
密码：123456
```

1. 注册并登录
2. 进入"频道广场"
3. 搜索"强提醒测试"
4. 点击频道卡片
5. 点击"订阅"

### Step 7: 模拟器 - 审核订阅

1. 在模拟器中点击底部"消息"标签
2. 看到订阅申请通知
3. 点击通知，弹出审核框
4. 选择"1分钟（测试）"
5. 点击"批准"

### Step 8: Web 端 - 开启强制提醒

1. 刷新频道详情页（F5）
2. 看到"已订阅"状态
3. 看到"开启强制提醒"按钮
4. **点击按钮**
5. **关键**：浏览器弹出权限请求

   **Chrome**:
   ```
   localhost 想要
   显示通知
   [阻止] [允许]
   ```
   **点击"允许"** ✅

6. 看到按钮变为橙色"强制提醒已开启"

### Step 9: 模拟器 - 发布内容

1. 在模拟器的频道详情页
2. 滚动到底部
3. 在输入框输入：`Web端测试强制提醒`
4. 点击"发布"

### Step 10: Web 端 - 验证提醒

**立即应该看到**：

✅ **浏览器通知**（右下角弹出）
```
🔔 【强制提醒】强提醒测试
📢 Web端测试强制提醒
```

✅ **浏览器控制台日志**（F12）
```
强制提醒已发送: 强提醒测试 - Web端测试强制提醒
```

⚠️ **震动效果**（取决于浏览器）
- Chrome on Windows：可能不震动
- Chrome on Android：会震动
- Firefox：部分支持

## 🔍 Web 端验证清单

- [ ] 看到浏览器通知弹出
- [ ] 通知标题包含"🔔【强制提醒】"
- [ ] 通知内容包含"📢"
- [ ] 通知停留10秒后自动关闭
- [ ] 点击通知可以聚焦到页面
- [ ] 开启按钮变为橙色
- [ ] 关闭后按钮变回蓝色

## 🐛 Web 端常见问题

### 问题1：没有弹出通知权限请求

**解决方案**：
1. 检查浏览器设置
   - Chrome: 设置 → 隐私和安全 → 网站设置 → 通知
   - 确保 localhost 不在"阻止"列表中

2. 手动重置权限
   - 点击地址栏左侧的 🔒 图标
   - 通知 → "重置权限"
   - 刷新页面重试

### 问题2：允许了权限但没有通知

**排查步骤**：

1. **检查浏览器控制台**（F12）
   ```javascript
   // 查看通知权限状态
   console.log('Notification permission:', Notification.permission);
   // 应该显示: "granted"
   ```

2. **检查系统通知设置**
   - Windows: 设置 → 系统 → 通知
   - 确保 Chrome/Firefox 的通知是开启的

3. **测试通知API**
   ```javascript
   // 在控制台执行
   new Notification('测试', {
     body: '这是测试通知',
     requireInteraction: true
   });
   ```

### 问题3：通知立即消失

这是正常的，Web通知默认会自动关闭。我们的代码设置为10秒后关闭。

### 问题4：没有震动

**原因**：
- PC浏览器大多不支持震动API
- 需要在支持震动的设备上测试（如手机浏览器）

**验证方法**：
```javascript
// 在控制台执行
if ('vibrate' in navigator) {
  console.log('✅ 支持震动');
  navigator.vibrate(1000); // 震动1秒
} else {
  console.log('❌ 不支持震动');
}
```

## 📊 功能对比表

| 功能 | 模拟器 (Expo Go) | Web 浏览器 | 说明 |
|------|-----------------|-----------|------|
| 震动提醒 | ✅ 完全支持 | ⚠️ 部分支持 | PC浏览器通常不震动 |
| 横幅通知 | ✅ 完全支持 | ✅ 完全支持 | 浏览器原生通知 |
| 声音提醒 | ✅ 完全支持 | ✅ 完全支持 | 系统默认声音 |
| 锁屏显示 | ✅ 完全支持 | ❌ 不支持 | Web 限制 |
| 通知优先级 | ✅ MAX | ⚠️ 普通 | 浏览器限制 |
| 自定义音效 | ✅ 支持 | ❌ 不支持 | 使用系统声音 |
| 后台接收 | ✅ 支持 | ⚠️ 页面需打开 | Service Worker可改善 |

## 💡 测试技巧

### 技巧1：并排显示

- 左侧：Android 模拟器（频道主）
- 右侧：浏览器窗口（用户）
- 底部：Expo 终端（查看日志）

这样可以同时观察两端的变化。

### 技巧2：使用浏览器控制台

打开 F12 开发者工具，可以：
- 查看通知相关日志
- 调试通知权限问题
- 手动触发通知测试

### 技巧3：模拟器快捷键

- `Ctrl + M`：打开 Expo 开发菜单
- `R`：重新加载应用
- `D`：打开调试工具

### 技巧4：快速切换账号

在 Web 端可以快速登出登入，无需重启应用。

## 🚀 高级测试场景

### 场景1：多标签页测试

1. 打开多个浏览器标签页
2. 每个标签页登录不同账号
3. 测试多个用户同时接收提醒

### 场景2：不同浏览器测试

- Chrome：完整功能
- Firefox：完整功能
- Edge：完整功能
- Safari：部分功能

### 场景3：移动端浏览器测试

如果有手机，可以：
1. 手机浏览器访问 `http://[电脑IP]:8081`
2. 测试移动端浏览器的震动功能
3. 对比原生应用体验

## ✅ 测试完成确认

完成以下检查：

- [ ] 模拟器成功创建频道
- [ ] Web 端成功订阅频道
- [ ] 模拟器成功审核申请
- [ ] Web 端成功开启强制提醒
- [ ] Web 端收到浏览器通知
- [ ] 通知内容正确显示
- [ ] 通知包含特殊标识
- [ ] 关闭提醒后不再收到通知

## 📝 测试记录

| 项目 | 结果 | 备注 |
|------|------|------|
| 模拟器版本 | __________ | |
| 浏览器 | __________ | Chrome/Firefox/Edge |
| 通知权限 | __________ | 允许/阻止 |
| 震动支持 | __________ | 是/否 |
| 通知显示 | __________ | 正常/异常 |
| 测试时间 | __________ | |

---

## 🎉 测试成功标准

如果您看到：
1. ✅ Web 浏览器右下角弹出通知
2. ✅ 通知标题带有"🔔【强制提醒】"
3. ✅ 通知可以正常显示和关闭
4. ✅ 开启/关闭按钮状态正确

**恭喜！测试成功！** 🎊

虽然 Web 端的震动和锁屏功能受限，但核心的强制提醒通知功能完全正常工作！
