# èŠå¤©å›¾ç‰‡æ¶ˆæ¯åŠŸèƒ½ä¼˜åŒ–è¯´æ˜

## ğŸ› é—®é¢˜æè¿°

**åŸé—®é¢˜**ï¼šåœ¨èŠå¤©è¯¦æƒ…é¡µå‘é€å›¾ç‰‡æ—¶ï¼Œå›¾ç‰‡æ— æ³•æ˜¾ç¤ºï¼Œåªæ˜¾ç¤ºè“è‰²çš„å›¾æ ‡å ä½ç¬¦ã€‚

**æ ¹æœ¬åŸå› **ï¼š
1. å‘é€å›¾ç‰‡æ—¶åªä¼ é€’äº†æ–‡æœ¬"[å›¾ç‰‡]"ï¼Œæ²¡æœ‰ä¼ é€’å®é™…çš„å›¾ç‰‡URI
2. æ¸²æŸ“æ¶ˆæ¯æ—¶åªæ˜¾ç¤ºäº†å ä½ç¬¦å›¾æ ‡ï¼Œæ²¡æœ‰æ˜¾ç¤ºå®é™…å›¾ç‰‡
3. ç¼ºå°‘å›¾ç‰‡ç‚¹å‡»é¢„è§ˆåŠŸèƒ½

## âœ… å·²å®ç°çš„åŠŸèƒ½

### 1. **å›¾ç‰‡URIä¼ é€’**
**æ–‡ä»¶**ï¼š`src/screens/ChatDetailScreen.js`

**ä¿®æ”¹å†…å®¹**ï¼š
```javascript
// å‘é€å›¾ç‰‡æ—¶ä¼ é€’å®é™…çš„å›¾ç‰‡URI
const imageUri = result.assets[0].uri;
const sendResult = await sendMessage(
  conversationId, 
  user.id, 
  imageUri,  // ä½¿ç”¨å›¾ç‰‡URIè€Œä¸æ˜¯'[å›¾ç‰‡]'
  'image'
);
```

### 2. **å›¾ç‰‡æ¶ˆæ¯æ¸²æŸ“**
**æ–‡ä»¶**ï¼š`src/screens/ChatDetailScreen.js`

**ä¿®æ”¹å†…å®¹**ï¼š
```javascript
{message.type === 'image' && (
  <TouchableOpacity 
    onPress={() => setPreviewImage(message.content)}
    activeOpacity={0.8}
  >
    <Image 
      source={{ uri: message.content }} 
      style={styles.messageImage}
      resizeMode="cover"
    />
  </TouchableOpacity>
)}
```

### 3. **å›¾ç‰‡å…¨å±é¢„è§ˆ**
**æ–‡ä»¶**ï¼š`src/screens/ChatDetailScreen.js`

**æ–°å¢åŠŸèƒ½**ï¼š
- æ·»åŠ äº†é¢„è§ˆå›¾ç‰‡çŠ¶æ€ï¼š`previewImage`
- æ·»åŠ äº†å…¨å±é¢„è§ˆModal
- ç‚¹å‡»å›¾ç‰‡å¯å…¨å±æŸ¥çœ‹
- ç‚¹å‡»å…³é—­æŒ‰é’®æˆ–èƒŒæ™¯å¯é€€å‡ºé¢„è§ˆ

**å…³é”®ä»£ç **ï¼š
```javascript
<Modal
  visible={previewImage !== null}
  transparent={true}
  animationType="fade"
  onRequestClose={() => setPreviewImage(null)}
>
  <View style={styles.imagePreviewContainer}>
    <TouchableOpacity 
      style={styles.imagePreviewOverlay}
      onPress={() => setPreviewImage(null)}
    >
      <TouchableOpacity 
        style={styles.closeButton}
        onPress={() => setPreviewImage(null)}
      >
        <Ionicons name="close" size={30} color="white" />
      </TouchableOpacity>
      
      <Image 
        source={{ uri: previewImage }} 
        style={styles.previewImage}
        resizeMode="contain"
      />
    </TouchableOpacity>
  </View>
</Modal>
```

### 4. **æ¶ˆæ¯åˆ—è¡¨ä¼˜åŒ–**
**æ–‡ä»¶**ï¼š`src/context/ChatContext.js`

**ä¿®æ”¹å†…å®¹**ï¼š
```javascript
// å¦‚æœæ˜¯å›¾ç‰‡æ¶ˆæ¯ï¼Œæ˜¾ç¤º'[å›¾ç‰‡]'ä½œä¸ºæœ€åæ¶ˆæ¯æ‘˜è¦
conversation.lastMessage = type === 'image' ? '[å›¾ç‰‡]' : content;
```

è¿™æ ·åœ¨æ¶ˆæ¯åˆ—è¡¨ä¸­æ˜¾ç¤º"[å›¾ç‰‡]"æ‘˜è¦ï¼Œè€Œä¸æ˜¯æ˜¾ç¤ºå›¾ç‰‡URIã€‚

## ğŸ¨ æ ·å¼è®¾è®¡

### å›¾ç‰‡æ¶ˆæ¯æ ·å¼
```javascript
messageImage: {
  width: 200,
  height: 200,
  borderRadius: 12,
},
```

### å›¾ç‰‡é¢„è§ˆæ ·å¼
```javascript
imagePreviewContainer: {
  flex: 1,
  backgroundColor: 'rgba(0, 0, 0, 0.9)',
  justifyContent: 'center',
  alignItems: 'center',
},
previewImage: {
  width: Dimensions.get('window').width,
  height: Dimensions.get('window').height,
},
closeButton: {
  position: 'absolute',
  top: 50,
  right: 20,
  zIndex: 10,
  backgroundColor: 'rgba(0, 0, 0, 0.5)',
  borderRadius: 25,
  width: 50,
  height: 50,
  justifyContent: 'center',
  alignItems: 'center',
},
```

## ğŸš€ åŠŸèƒ½ç‰¹ç‚¹

### 1. **å›¾ç‰‡æ˜¾ç¤º**
- âœ… 200x200 åœ†è§’å›¾ç‰‡æ˜¾ç¤º
- âœ… è‡ªåŠ¨é€‚é…å›¾ç‰‡æ¯”ä¾‹
- âœ… ä¿æŒåœ¨æ¶ˆæ¯æ°”æ³¡å†…

### 2. **äº¤äº’ä½“éªŒ**
- âœ… ç‚¹å‡»å›¾ç‰‡æ”¾å¤§é¢„è§ˆ
- âœ… å…¨å±æ˜¾ç¤ºå›¾ç‰‡
- âœ… é»‘è‰²åŠé€æ˜èƒŒæ™¯
- âœ… å³ä¸Šè§’å…³é—­æŒ‰é’®
- âœ… ç‚¹å‡»èƒŒæ™¯é€€å‡ºé¢„è§ˆ

### 3. **æ¶ˆæ¯åˆ—è¡¨**
- âœ… æ˜¾ç¤º"[å›¾ç‰‡]"æ‘˜è¦
- âœ… å›¾ç‰‡æ¶ˆæ¯æ­£å¸¸è®¡å…¥æœªè¯»æ•°
- âœ… å›¾ç‰‡æ¶ˆæ¯æ­£å¸¸æ’åº

## ğŸ“± æµ‹è¯•æ­¥éª¤

### 1. å‘é€å›¾ç‰‡
1. ç™»å½•ä¸¤ä¸ªä¸åŒçš„è´¦æˆ·
2. è¿›å…¥èŠå¤©è¯¦æƒ…é¡µ
3. ç‚¹å‡»å›¾ç‰‡æŒ‰é’®ï¼ˆğŸ“·å›¾æ ‡ï¼‰
4. é€‰æ‹©å›¾ç‰‡å¹¶å‘é€
5. **éªŒè¯**ï¼šå›¾ç‰‡åº”è¯¥æ­£å¸¸æ˜¾ç¤ºï¼Œå¤§å°ä¸º200x200

### 2. æŸ¥çœ‹å›¾ç‰‡
1. ç‚¹å‡»èŠå¤©ä¸­çš„å›¾ç‰‡
2. **éªŒè¯**ï¼šå›¾ç‰‡åº”è¯¥å…¨å±æ˜¾ç¤º
3. ç‚¹å‡»å³ä¸Šè§’å…³é—­æŒ‰é’®æˆ–èƒŒæ™¯
4. **éªŒè¯**ï¼šè¿”å›èŠå¤©ç•Œé¢

### 3. æ¶ˆæ¯åˆ—è¡¨
1. å‘é€å›¾ç‰‡åè¿”å›æ¶ˆæ¯åˆ—è¡¨
2. **éªŒè¯**ï¼šåº”è¯¥æ˜¾ç¤º"[å›¾ç‰‡]"æ–‡å­—
3. å¯¹æ–¹è´¦æˆ·æŸ¥çœ‹æ¶ˆæ¯åˆ—è¡¨
4. **éªŒè¯**ï¼šæ˜¾ç¤ºæœªè¯»å¾½ç« å’Œ"[å›¾ç‰‡]"æ‘˜è¦

## ğŸ¯ æŠ€æœ¯å®ç°

### æ•°æ®æµ
```
1. ç”¨æˆ·é€‰æ‹©å›¾ç‰‡
   â†“
2. è·å–å›¾ç‰‡URI (file://...)
   â†“
3. è°ƒç”¨sendMessage(conversationId, userId, imageUri, 'image')
   â†“
4. ChatContextä¿å­˜æ¶ˆæ¯
   {
     id: '1',
     type: 'image',
     content: 'file:///...',  // å›¾ç‰‡URI
     senderId: 'xxx',
     timestamp: 123456789
   }
   â†“
5. æ¸²æŸ“æ—¶æ˜¾ç¤ºå›¾ç‰‡
   <Image source={{ uri: message.content }} />
```

### æ¶ˆæ¯ç±»å‹
```javascript
// æ–‡æœ¬æ¶ˆæ¯
{
  type: 'text',
  content: 'æ¶ˆæ¯å†…å®¹'
}

// å›¾ç‰‡æ¶ˆæ¯
{
  type: 'image',
  content: 'file:///path/to/image.jpg'
}
```

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. **å›¾ç‰‡æƒé™**
- é¦–æ¬¡å‘é€å›¾ç‰‡æ—¶ä¼šè¯·æ±‚ç›¸å†Œæƒé™
- å¦‚æœæƒé™è¢«æ‹’ç»ï¼Œä¼šæç¤ºç”¨æˆ·

### 2. **å›¾ç‰‡è´¨é‡**
- å½“å‰è®¾ç½®ä¸º 0.8 è´¨é‡å‹ç¼©
- å¯ä»¥æ ¹æ®éœ€è¦è°ƒæ•´ quality å‚æ•°

### 3. **å›¾ç‰‡å¤§å°**
- æ¶ˆæ¯ä¸­çš„å›¾ç‰‡å›ºå®šä¸º 200x200
- é¢„è§ˆæ—¶æŒ‰å±å¹•å°ºå¯¸è‡ªé€‚åº”

### 4. **å­˜å‚¨æ–¹å¼**
- å›¾ç‰‡URIå­˜å‚¨åœ¨å†…å­˜ä¸­
- åº”ç”¨é‡å¯åå›¾ç‰‡URIå¯èƒ½å¤±æ•ˆ
- ç”Ÿäº§ç¯å¢ƒå»ºè®®ä¸Šä¼ åˆ°æœåŠ¡å™¨

## ğŸ”§ æœªæ¥ä¼˜åŒ–å»ºè®®

### 1. **å›¾ç‰‡ä¸Šä¼ **
```javascript
// å°†å›¾ç‰‡ä¸Šä¼ åˆ°æœåŠ¡å™¨
const uploadImage = async (imageUri) => {
  const formData = new FormData();
  formData.append('image', {
    uri: imageUri,
    type: 'image/jpeg',
    name: 'photo.jpg'
  });
  
  const response = await fetch('your-api/upload', {
    method: 'POST',
    body: formData
  });
  
  return response.json(); // è¿”å›æœåŠ¡å™¨URL
};
```

### 2. **å›¾ç‰‡ç¼“å­˜**
```javascript
// ä½¿ç”¨å›¾ç‰‡ç¼“å­˜åº“
import FastImage from 'react-native-fast-image';

<FastImage
  source={{ uri: message.content }}
  style={styles.messageImage}
  resizeMode={FastImage.resizeMode.cover}
/>
```

### 3. **å›¾ç‰‡åŠ è½½çŠ¶æ€**
```javascript
// æ˜¾ç¤ºåŠ è½½æŒ‡ç¤ºå™¨
{isLoading && <ActivityIndicator />}
```

### 4. **å¤šå›¾ç‰‡æ”¯æŒ**
```javascript
// æ”¯æŒä¸€æ¬¡å‘é€å¤šå¼ å›¾ç‰‡
const sendMultipleImages = async (imageUris) => {
  for (const uri of imageUris) {
    await sendMessage(conversationId, userId, uri, 'image');
  }
};
```

### 5. **å›¾ç‰‡ç¼–è¾‘**
```javascript
// å‘é€å‰å¯ä»¥ç¼–è¾‘å›¾ç‰‡
allowsEditing: true,  // ImagePickeré…ç½®
```

## ğŸ“Š æ•ˆæœå¯¹æ¯”

### ä¿®æ”¹å‰
```
[èŠå¤©ç•Œé¢]
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ‘¤  â”Œâ”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚      â”‚  ğŸ“·   â”‚  â”‚ â† åªæ˜¾ç¤ºå›¾æ ‡
â”‚      â”‚ å›¾ç‰‡  â”‚  â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¿®æ”¹å
```
[èŠå¤©ç•Œé¢]
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ‘¤  â”Œâ”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚      â”‚ [å›¾ç‰‡] â”‚  â”‚ â† æ˜¾ç¤ºå®é™…å›¾ç‰‡
â”‚      â”‚       â”‚  â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[ç‚¹å‡»å›¾ç‰‡]
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        âŒ        â”‚ â† å…³é—­æŒ‰é’®
â”‚                 â”‚
â”‚   [å…¨å±å›¾ç‰‡]     â”‚ â† å…¨å±é¢„è§ˆ
â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ‰ æ€»ç»“

é€šè¿‡æœ¬æ¬¡ä¼˜åŒ–ï¼š
- âœ… **å›¾ç‰‡æ­£å¸¸æ˜¾ç¤º** - 200x200åœ†è§’å›¾ç‰‡
- âœ… **ç‚¹å‡»é¢„è§ˆ** - å…¨å±æŸ¥çœ‹å›¾ç‰‡
- âœ… **äº¤äº’æµç•…** - ä¼˜é›…çš„åŠ¨ç”»å’Œå…³é—­æ–¹å¼
- âœ… **æ¶ˆæ¯æ‘˜è¦** - åˆ—è¡¨ä¸­æ˜¾ç¤º"[å›¾ç‰‡]"
- âœ… **å®Œæ•´åŠŸèƒ½** - å‘é€ã€æ˜¾ç¤ºã€é¢„è§ˆä¸€ä½“åŒ–

ç°åœ¨èŠå¤©åŠŸèƒ½æ›´åŠ å®Œå–„ï¼Œç”¨æˆ·å¯ä»¥æ­£å¸¸å‘é€å’ŒæŸ¥çœ‹å›¾ç‰‡äº†ï¼ğŸŠ

---

**ç‰ˆæœ¬**ï¼šv1.0
**æ›´æ–°æ—¶é—´**ï¼š2025-10
**çŠ¶æ€**ï¼šå·²å®æ–½ âœ…
