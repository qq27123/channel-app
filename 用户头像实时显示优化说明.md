# ç”¨æˆ·å¤´åƒå®æ—¶æ˜¾ç¤ºä¼˜åŒ–è¯´æ˜

## é—®é¢˜æè¿°
åœ¨æ¶ˆæ¯é¡µå’Œæ¶ˆæ¯è¯¦æƒ…é¡µä¸­ï¼Œæ™®é€šç”¨æˆ·æ— æ³•çœ‹åˆ°ç®¡ç†å‘˜çš„æœ€æ–°å¤´åƒï¼Œè€Œç®¡ç†å‘˜å¯ä»¥çœ‹åˆ°ç”¨æˆ·çš„å¤´åƒã€‚è¿™æ˜¯å› ä¸ºå¤´åƒä¿¡æ¯åœ¨åˆ›å»ºå¯¹è¯æ—¶è¢«å¿«ç…§ä¿å­˜ï¼Œæ²¡æœ‰å®æ—¶æ›´æ–°ã€‚

## é—®é¢˜åŸå› 
1. **æ•°æ®å¿«ç…§**ï¼šåœ¨åˆ›å»ºå¯¹è¯æ—¶ï¼Œç”¨æˆ·çš„å¤´åƒä¿¡æ¯è¢«ä¿å­˜åœ¨å¯¹è¯çš„å‚ä¸è€…ä¿¡æ¯ä¸­
2. **ç¼ºä¹å®æ—¶æ›´æ–°**ï¼šå½“ç”¨æˆ·ä¿®æ”¹å¤´åƒåï¼Œå¯¹è¯ä¸­ä¿å­˜çš„æ—§å¤´åƒä¿¡æ¯æ²¡æœ‰æ›´æ–°
3. **å•å‘åŒæ­¥**ï¼šç®¡ç†å‘˜å¤´åƒæ›´æ–°åï¼Œæ™®é€šç”¨æˆ·ç«¯æ²¡æœ‰è·å–æœ€æ–°ä¿¡æ¯

## è§£å†³æ–¹æ¡ˆ

### 1. é¢‘é“å¹¿åœºåˆ›å»ºå¯¹è¯ä¼˜åŒ–
åœ¨ `ChannelSquareScreen.js` ä¸­ï¼Œåˆ›å»ºå¯¹è¯æ—¶ä½¿ç”¨å®æ—¶è·å–çš„å¤´åƒï¼š

```javascript
// å®æ—¶è·å–åˆ›å»ºè€…ä¿¡æ¯ï¼Œç¡®ä¿ä½¿ç”¨æœ€æ–°çš„å¤´åƒ
const creator = getUserById(channel.creatorId);
const creatorAvatar = creator?.avatar || channel.creatorAvatar;
const creatorName = creator?.nickname || channel.creatorName;

// åˆ›å»ºæˆ–è·å–å¯¹è¯æ—¶ä½¿ç”¨å®æ—¶å¤´åƒ
const conversation = getOrCreateConversation(
  user.id,
  channel.creatorId,
  { nickname: user.nickname, avatar: user.avatar },
  { nickname: creatorName, avatar: creatorAvatar }
);
```

### 2. æ¶ˆæ¯åˆ—è¡¨é¡µä¼˜åŒ–
åœ¨ `MessagesScreen.js` ä¸­å®æ—¶è·å–å¯¹æ–¹ç”¨æˆ·å¤´åƒï¼š

```javascript
const renderConversationItem = ({ item: conversation }) => {
  // å®æ—¶è·å–å¯¹æ–¹ç”¨æˆ·çš„æœ€æ–°å¤´åƒ
  const currentUser = getUserById(otherUser.id);
  const currentAvatar = currentUser?.avatar || otherUser.avatar;
  const currentNickname = currentUser?.nickname || otherUser.nickname;
  
  // ä½¿ç”¨ currentAvatar å’Œ currentNickname æ¸²æŸ“
};
```

### 3. èŠå¤©è¯¦æƒ…é¡µä¼˜åŒ–
åœ¨ `ChatDetailScreen.js` ä¸­å®æ—¶è·å–åŒæ–¹ç”¨æˆ·å¤´åƒï¼š

```javascript
// å®æ—¶è·å–å‘é€è€…çš„æœ€æ–°å¤´åƒ
const currentUser = getUserById(user.id);
const myAvatar = currentUser?.avatar || user.avatar;

// å®æ—¶è·å–å¯¹æ–¹ç”¨æˆ·çš„æœ€æ–°å¤´åƒ
const otherUserCurrent = getUserById(initialOtherUser.id);
const otherUserAvatar = otherUserCurrent?.avatar || initialOtherUser.avatar;
```

## æŠ€æœ¯å®ç°

### 1. å¯¼å…¥ getUserById
```javascript
const { user, getUserById } = useAuth();
```

### 2. å®æ—¶å¤´åƒæŸ¥è¯¢
```javascript
// ä¼˜å…ˆçº§å›é€€æœºåˆ¶
const currentAvatar = currentUser?.avatar || otherUser.avatar;
```

### 3. ç©ºå€¼å®‰å…¨å¤„ç†
```javascript
{currentAvatar ? (
  <Image source={{ uri: currentAvatar }} style={styles.avatar} />
) : (
  <View style={[styles.avatar, styles.defaultAvatar]}>
    <Ionicons name="person-outline" size={24} color="#999" />
  </View>
)}
```

## ä¼˜åŠ¿

âœ… **å®æ—¶åŒæ­¥**ï¼šç”¨æˆ·ä¿®æ”¹å¤´åƒåï¼Œæ‰€æœ‰ç›¸å…³é¡µé¢ç«‹å³æ˜¾ç¤ºæ–°å¤´åƒ
âœ… **åŒå‘æ›´æ–°**ï¼šç®¡ç†å‘˜å’Œæ™®é€šç”¨æˆ·éƒ½èƒ½çœ‹åˆ°å¯¹æ–¹çš„æœ€æ–°å¤´åƒ
âœ… **å…¼å®¹æ€§å¼º**ï¼šå¦‚æœè·å–ä¸åˆ°æœ€æ–°å¤´åƒï¼Œå›é€€åˆ°åŸæœ‰å¤´åƒ
âœ… **ç”¨æˆ·ä½“éªŒ**ï¼šå¢å¼ºèŠå¤©ç•Œé¢çš„ä¸ªæ€§åŒ–å’Œè¯†åˆ«åº¦

## æµ‹è¯•æ­¥éª¤

### 1. å‡†å¤‡æµ‹è¯•ç¯å¢ƒ
1. å¯åŠ¨ Expo å¼€å‘æœåŠ¡å™¨
2. åœ¨ Android æ¨¡æ‹Ÿå™¨æˆ–çœŸæœºä¸Šæ‰“å¼€åº”ç”¨

### 2. åˆ›å»ºæµ‹è¯•ç”¨æˆ·
1. ä½¿ç”¨ç®¡ç†å‘˜è´¦æˆ·ç™»å½•ï¼ˆ13800138000/123456ï¼‰
2. æ³¨å†Œä¸€ä¸ªæ™®é€šç”¨æˆ·è´¦æˆ·

### 3. éªŒè¯å¤´åƒæ˜¾ç¤º
1. **ç®¡ç†å‘˜ä¿®æ”¹å¤´åƒ**ï¼š
   - ç®¡ç†å‘˜è¿›å…¥ä¸ªäººä¸­å¿ƒ
   - ç‚¹å‡»å¤´åƒä¸Šä¼ æ–°å›¾ç‰‡
2. **æ™®é€šç”¨æˆ·æŸ¥çœ‹**ï¼š
   - æ™®é€šç”¨æˆ·ç™»å½•
   - è¿›å…¥"æ¶ˆæ¯"é¡µé¢ â†’ åº”è¯¥çœ‹åˆ°ç®¡ç†å‘˜çš„æ–°å¤´åƒ
   - ç‚¹å‡»è¿›å…¥èŠå¤©è¯¦æƒ…é¡µ â†’ åº”è¯¥çœ‹åˆ°ç®¡ç†å‘˜çš„æ–°å¤´åƒ

### 4. éªŒè¯åŒå‘æ›´æ–°
1. **æ™®é€šç”¨æˆ·ä¿®æ”¹å¤´åƒ**ï¼š
   - æ™®é€šç”¨æˆ·è¿›å…¥ä¸ªäººä¸­å¿ƒ
   - ç‚¹å‡»å¤´åƒä¸Šä¼ æ–°å›¾ç‰‡
2. **ç®¡ç†å‘˜æŸ¥çœ‹**ï¼š
   - ç®¡ç†å‘˜ç™»å½•
   - è¿›å…¥"æ¶ˆæ¯"é¡µé¢ â†’ åº”è¯¥çœ‹åˆ°æ™®é€šç”¨æˆ·çš„æ–°å¤´åƒ
   - ç‚¹å‡»è¿›å…¥èŠå¤©è¯¦æƒ…é¡µ â†’ åº”è¯¥çœ‹åˆ°æ™®é€šç”¨æˆ·çš„æ–°å¤´åƒ

## UI æ•ˆæœ

### ä¿®å¤å‰
```
[æ—§å¤´åƒ] ç”¨æˆ·å
[æ—§å¤´åƒ] æ¶ˆæ¯å†…å®¹
```

### ä¿®å¤å
```
[æ–°å¤´åƒ] ç”¨æˆ·å
[æ–°å¤´åƒ] æ¶ˆæ¯å†…å®¹
```

## ç›¸å…³æ–‡ä»¶
- `d:\wenjianjia2\channel-app\src\screens\ChannelSquareScreen.js` - é¢‘é“å¹¿åœº
- `d:\wenjianjia2\channel-app\src\screens\MessagesScreen.js` - æ¶ˆæ¯åˆ—è¡¨é¡µ
- `d:\wenjianjia2\channel-app\src\screens\ChatDetailScreen.js` - èŠå¤©è¯¦æƒ…é¡µ
- `d:\wenjianjia2\channel-app\src\context\AuthContext.js` - ç”¨æˆ·è®¤è¯ä¸Šä¸‹æ–‡

## æ³¨æ„äº‹é¡¹

### 1. æ€§èƒ½è€ƒè™‘
- `getUserById` æ˜¯è½»é‡çº§æŸ¥è¯¢ï¼Œåªåœ¨æ¸²æŸ“æ—¶è°ƒç”¨
- ä½¿ç”¨äº†å¯é€‰é“¾æ“ä½œç¬¦ï¼ˆ?.ï¼‰é˜²æ­¢ç©ºå€¼é”™è¯¯
- å¤´åƒç¼“å­˜ç”± `getUserById` å†…éƒ¨å¤„ç†

### 2. å…¼å®¹æ€§
- æ”¯æŒç½‘ç»œå›¾ç‰‡å’Œæœ¬åœ°å›¾ç‰‡URI
- é»˜è®¤å¤´åƒä½¿ç”¨ç»Ÿä¸€çš„å›¾æ ‡è®¾è®¡
- é€‚é…ä¸åŒå±å¹•å°ºå¯¸

### 3. æ•°æ®ä¸€è‡´æ€§
- æ‰€æœ‰é¡µé¢ä½¿ç”¨ç›¸åŒçš„å¤´åƒè·å–é€»è¾‘
- ä¼˜å…ˆä½¿ç”¨å®æ—¶æ•°æ®ï¼Œå›é€€åˆ°å¿«ç…§æ•°æ®
- ç¡®ä¿ç®¡ç†å‘˜å’Œæ™®é€šç”¨æˆ·çœ‹åˆ°ä¸€è‡´çš„å¤´åƒ

## æœªæ¥ä¼˜åŒ–å»ºè®®

### 1. å¤´åƒç¼“å­˜
å¯ä»¥è€ƒè™‘æ·»åŠ å¤´åƒç¼“å­˜æœºåˆ¶ï¼Œæå‡åŠ è½½é€Ÿåº¦ï¼š
```javascript
// å¯é€‰ä¼˜åŒ–
const [avatarCache, setAvatarCache] = useState({});
```

### 2. å¤´åƒé¢„åŠ è½½
åœ¨è¿›å…¥æ¶ˆæ¯é¡µé¢æ—¶é¢„åŠ è½½å¸¸ç”¨ç”¨æˆ·å¤´åƒï¼š
```javascript
// å¯é€‰ä¼˜åŒ–
useEffect(() => {
  // é¢„åŠ è½½å¸¸ç”¨è”ç³»äººå¤´åƒ
}, []);
```

### 3. å¤´åƒç‚¹å‡»åŠŸèƒ½
å¯ä»¥æ·»åŠ å¤´åƒç‚¹å‡»åŠŸèƒ½ï¼ŒæŸ¥çœ‹ç”¨æˆ·è¯¦æƒ…ï¼š
```javascript
// å¯é€‰åŠŸèƒ½
<TouchableOpacity onPress={() => showUserDetail(userId)}>
  <Image source={{ uri: avatar }} style={styles.avatar} />
</TouchableOpacity>
```

## æŠ€æœ¯äº®ç‚¹

### 1. å®æ—¶æ•°æ®æŸ¥è¯¢
éµå¾ª"ç”¨æˆ·ä¿¡æ¯å®æ—¶æŸ¥è¯¢æœ€ä½³å®è·µ"ï¼Œé¿å…åœ¨ä¸šåŠ¡å¯¹è±¡ä¸­å­˜å‚¨å†—ä½™ç”¨æˆ·ä¿¡æ¯ã€‚

### 2. ä¼˜å…ˆçº§å›é€€
```javascript
const currentAvatar = currentUser?.avatar || otherUser.avatar;
```
ä¼˜å…ˆä½¿ç”¨æœ€æ–°ç”¨æˆ·æ•°æ®ï¼Œå›é€€åˆ°åŸæœ‰æ•°æ®ã€‚

### 3. ç©ºå€¼å®‰å…¨
ä½¿ç”¨å¯é€‰é“¾æ“ä½œç¬¦å’Œæ¡ä»¶æ¸²æŸ“ï¼Œç¡®ä¿ä¸ä¼šå‡ºç°ç©ºå€¼é”™è¯¯ã€‚

## æ€»ç»“
é€šè¿‡è¿™æ¬¡ä¼˜åŒ–ï¼Œæ¶ˆæ¯ç³»ç»Ÿä¸­çš„å¤´åƒæ˜¾ç¤ºé—®é¢˜å¾—åˆ°å½»åº•è§£å†³ï¼š
- âœ… ç®¡ç†å‘˜å’Œæ™®é€šç”¨æˆ·éƒ½èƒ½çœ‹åˆ°å¯¹æ–¹çš„æœ€æ–°å¤´åƒ
- âœ… å¤´åƒå®æ—¶åŒæ­¥ç”¨æˆ·æœ€æ–°çŠ¶æ€
- âœ… ç•Œé¢ç¾è§‚åº¦å’Œè¯†åˆ«åº¦æé«˜
- âœ… ä»£ç ç»“æ„æ¸…æ™°ï¼Œæ˜“äºç»´æŠ¤

ç°åœ¨ç”¨æˆ·åœ¨æ¶ˆæ¯ç³»ç»Ÿä¸­å¯ä»¥æ¸…æ¥šåœ°çœ‹åˆ°å¯¹æ–¹çš„æœ€æ–°å¤´åƒï¼Œæå‡äº†æ•´ä½“çš„ç”¨æˆ·ä½“éªŒï¼ğŸ‰