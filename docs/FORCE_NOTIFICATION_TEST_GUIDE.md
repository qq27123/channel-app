# 单设备测试强制提醒功能指南

## 🎯 测试目标

验证强制提醒的完整流程：
1. 频道主创建频道
2. 用户订阅频道
3. 用户开启强制提醒
4. 频道主发布内容
5. 用户收到强制提醒（震动+声音+通知）

---

## 📱 方法一：双设备测试（推荐）

### 设备准备
- 设备A：频道主账号
- 设备B：普通用户账号
- 两台设备都安装 Expo Go

### 详细步骤

#### 第一步：启动应用

```bash
cd d:\wenjianjia2\channel-app
npx expo start
```

在终端会显示一个二维码。

#### 第二步：设备A - 创建频道主账号

1. **打开 Expo Go**，扫描二维码
2. **注册账号**：
   ```
   用户名：频道主
   手机号：13800000001
   密码：123456
   ```
3. **登录**后进入"个人中心"
4. **创建频道**：
   - 频道名称：`强提醒测试频道`
   - 描述：`用于测试强制提醒功能`
   - 分类：`科技`
   - 点击"创建"
5. 记住频道名称，稍后在设备B查找

#### 第三步：设备B - 创建用户账号并订阅

1. **打开 Expo Go**，扫描同一个二维码
2. **注册新账号**（不同的用户名）：
   ```
   用户名：测试用户
   手机号：13800000002
   密码：123456
   ```
3. **登录**后进入"频道广场"
4. **找到频道**：
   - 在搜索框输入"强提醒测试"
   - 或在列表中找到"强提醒测试频道"
5. **点击频道卡片**进入详情页
6. **点击"订阅"按钮**
7. 看到"订阅申请已提交，请等待频道主审核"

#### 第四步：设备A - 审核订阅申请

1. 进入"消息"页面（底部导航栏）
2. 看到新的订阅申请通知：
   ```
   📝 订阅申请
   测试用户 申请订阅您的频道
   ```
3. **点击通知**，弹出审核对话框
4. **选择会员期限**：
   - 推荐选择"1分钟（测试）"方便快速验证
   - 或选择"1个月"进行正式测试
5. **点击"批准"**
6. 看到"审核成功"提示

#### 第五步：设备B - 开启强制提醒

1. **返回频道详情页**（下拉刷新）
2. 看到按钮变成"已订阅"
3. 下方出现**"开启强制提醒"**按钮（蓝色边框）
4. **点击"开启强制提醒"**
5. **系统弹出权限请求**：
   - Android：允许通知权限
   - iOS：允许通知
6. 看到提示："已开启强制提醒功能"
7. 按钮变为**橙色**，文字变为"强制提醒已开启"

#### 第六步：设备A - 发布内容触发提醒

1. 在频道详情页，滚动到底部
2. 在输入框输入测试内容：
   ```
   这是一条测试强制提醒的消息！
   ```
3. **点击"发布"按钮**
4. 看到"内容发布成功"提示
5. 内容出现在频道内容列表顶部

#### 第七步：设备B - 验证强制提醒效果

**应该立即收到以下提醒：**

✅ **震动效果**
- 持续约1.5秒
- 震动模式：震-停-震-停-震
- 即使手机静音也会震动

✅ **横幅通知**
- 标题：`🔔 【强制提醒】强提醒测试频道`
- 内容：`📢 这是一条测试强制提醒的消息！`
- 在屏幕顶部显示

✅ **声音提醒**
- 如果添加了 `notification.mp3`：播放自定义音效
- 否则：播放系统默认通知声音

✅ **锁屏显示**
- 如果手机锁屏：通知会显示在锁屏界面
- 完整显示通知内容

---

## 📲 方法二：单设备测试（快速切换）

如果只有一台手机，可以通过快速登出登入切换账号。

### 步骤

1. **创建频道主账号**并创建频道
2. **登出**（个人中心 → 退出登录）
3. **注册新用户**账号
4. **订阅频道**
5. **登出**，重新登录频道主账号
6. **审核订阅**
7. **登出**，重新登录用户账号
8. **开启强制提醒**
9. **登出**，重新登录频道主账号
10. **发布内容**
11. 查看手机通知栏验证提醒

⚠️ **注意**：由于需要频繁切换，可能无法实时看到震动效果，建议使用双设备测试。

---

## 🔍 测试检查清单

### 开启强制提醒前

- [ ] 用户成功订阅频道
- [ ] 看到"已订阅"状态
- [ ] 看到"开启强制提醒"按钮

### 开启强制提醒后

- [ ] 按钮变为橙色
- [ ] 文字变为"强制提醒已开启"
- [ ] 实心铃铛图标

### 发布内容后（用户端）

- [ ] 收到震动（约1.5秒）
- [ ] 收到横幅通知
- [ ] 听到提醒声音
- [ ] 通知栏显示通知
- [ ] 锁屏时也能看到（如果锁屏）

### 特殊标识

- [ ] 通知标题包含 `🔔 【强制提醒】`
- [ ] 通知内容包含 `📢`
- [ ] 优先级最高（置顶显示）

---

## 🐛 常见问题排查

### 问题1：收不到通知

**检查**：
1. 是否允许了通知权限？
   - Android: 设置 → 应用 → Expo Go → 通知 → 允许
   - iOS: 设置 → Expo Go → 通知 → 允许

2. 是否开启了强制提醒？
   - 按钮应该是橙色的"强制提醒已开启"

3. 是否在前台？
   - 将应用切到后台或锁屏，效果更明显

### 问题2：没有震动

**检查**：
1. 手机是否开启了震动模式？
2. 系统设置中是否允许应用震动？
3. 某些手机需要在"振动和触感"中开启

### 问题3：没有声音

**检查**：
1. 手机音量是否静音？
2. 通知音量是否开启？
3. 是否添加了 `notification.mp3` 文件？
   - 如果没有，会使用系统默认声音

### 问题4：锁屏看不到

**检查**：
1. Android: 设置 → 应用 → Expo Go → 通知 → 锁屏通知 → 显示
2. iOS: 设置 → Expo Go → 通知 → 锁定屏幕 → 开启

---

## 📊 测试记录表

| 测试项 | 预期结果 | 实际结果 | 通过 |
|-------|---------|---------|------|
| 订阅流程 | 申请→审核→成功 | | □ |
| 开启强提醒 | 按钮变橙色 | | □ |
| 震动提醒 | 1.5秒震动 | | □ |
| 横幅通知 | 顶部显示 | | □ |
| 声音提醒 | 播放音效 | | □ |
| 锁屏显示 | 锁屏可见 | | □ |
| 特殊标识 | 🔔【强制提醒】 | | □ |
| 通知内容 | 完整显示 | | □ |

---

## 🎥 测试演示视频录制建议

如果需要录制演示视频：

1. **准备阶段**（10秒）
   - 展示两台设备，一台标注"频道主"，一台标注"用户"

2. **创建和订阅**（30秒）
   - 快进展示创建频道、订阅、审核过程

3. **开启强制提醒**（15秒）
   - 特写用户点击"开启强制提醒"
   - 展示按钮变化（蓝色 → 橙色）

4. **发布和提醒**（30秒）
   - 频道主发布内容
   - 立即切换到用户设备
   - 展示震动效果（画面抖动）
   - 展示横幅通知弹出
   - 展示通知栏内容

5. **锁屏测试**（20秒）
   - 用户设备锁屏
   - 频道主再次发布
   - 展示锁屏通知

---

## 💡 测试技巧

### 技巧1：使用开发者工具

在频道详情页，可以添加一个测试按钮直接触发通知（开发模式）：

```javascript
// 在 ChannelDetailScreen.js 中临时添加
<TouchableOpacity
  onPress={() => sendChannelNotification(channelId, channel.name, '测试消息')}
>
  <Text>🧪 测试强制提醒</Text>
</TouchableOpacity>
```

### 技巧2：查看控制台日志

在 Expo 终端中查看日志：
```
强提醒音效加载成功
强制提醒已发送: 强提醒测试频道 - 这是一条测试消息
```

### 技巧3：使用 Expo 通知调试

```bash
# 在终端运行
npx expo start --dev-client

# 然后按 'n' 键打开通知调试界面
```

---

## 🚀 高级测试场景

### 场景1：批量测试

创建多个频道，多个用户，测试：
- 同时接收多个频道的强制提醒
- 优先级排序
- 通知合并

### 场景2：网络测试

- 弱网环境下的提醒延迟
- 离线后重新上线收到的提醒

### 场景3：性能测试

- 连续发送多条消息的提醒效果
- 震动和音效的性能影响

---

## 📞 需要帮助？

如果测试过程中遇到问题：

1. 检查 Expo 终端的错误日志
2. 查看手机系统通知设置
3. 确认两台设备在同一网络
4. 重启 Expo 服务和应用

祝测试顺利！🎉
