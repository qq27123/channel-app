# åŒ—äº¬æ—¶é—´æ˜¾ç¤ºä¼˜åŒ–è¯´æ˜

## ğŸ“ é—®é¢˜æè¿°

åŸç³»ç»Ÿä¸­ï¼Œé¢‘é“å†…å®¹å‘å¸ƒæ—¶é—´ã€èŠå¤©æ¶ˆæ¯æ—¶é—´ç­‰æ˜¾ç¤ºçš„ä¸æ˜¯åŒ—äº¬æ—¶é—´ï¼ˆUTC+8ï¼‰ï¼Œè€Œæ˜¯æ ¹æ®ç”¨æˆ·è®¾å¤‡æœ¬åœ°æ—¶åŒºæ˜¾ç¤ºï¼Œå¯¼è‡´æ—¶é—´æ˜¾ç¤ºä¸å‡†ç¡®ã€‚

## âœ¨ è§£å†³æ–¹æ¡ˆ

åˆ›å»ºç»Ÿä¸€çš„æ—¶é—´å·¥å…·å‡½æ•°ï¼Œå°†æ‰€æœ‰æ—¶é—´æˆ³è½¬æ¢ä¸ºåŒ—äº¬æ—¶é—´ï¼ˆUTC+8ï¼‰åå†æ˜¾ç¤ºï¼Œç¡®ä¿æ‰€æœ‰ç”¨æˆ·çœ‹åˆ°çš„æ—¶é—´éƒ½æ˜¯ä¸€è‡´çš„åŒ—äº¬æ—¶é—´ã€‚

## ğŸ”§ æŠ€æœ¯å®ç°

### 1. åˆ›å»ºæ—¶é—´å·¥å…·æ–‡ä»¶

**æ–‡ä»¶è·¯å¾„**ï¼š`src/utils/timeUtils.js`

#### æ ¸å¿ƒå‡½æ•°è¯´æ˜

##### getBeijingTime(timestamp)
```javascript
/**
 * è·å–åŒ—äº¬æ—¶é—´
 * @param {number} timestamp - æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰
 * @returns {Date} åŒ—äº¬æ—¶é—´Dateå¯¹è±¡
 */
export const getBeijingTime = (timestamp) => {
  const date = new Date(timestamp);
  // è·å–UTCæ—¶é—´æˆ³
  const utcTime = date.getTime() + (date.getTimezoneOffset() * 60000);
  // è½¬æ¢ä¸ºåŒ—äº¬æ—¶é—´ï¼ˆUTC+8ï¼‰
  const beijingTime = new Date(utcTime + (8 * 3600000));
  return beijingTime;
};
```

**åŠŸèƒ½**ï¼šå°†ä»»æ„æ—¶åŒºçš„æ—¶é—´æˆ³è½¬æ¢ä¸ºåŒ—äº¬æ—¶é—´Dateå¯¹è±¡

**åŸç†**ï¼š
1. è·å–UTCæ—¶é—´ = æœ¬åœ°æ—¶é—´ + æ—¶åŒºåç§»
2. åŒ—äº¬æ—¶é—´ = UTCæ—¶é—´ + 8å°æ—¶

##### formatBeijingTime(timestamp, format)
```javascript
/**
 * æ ¼å¼åŒ–ä¸ºåŒ—äº¬æ—¶é—´å­—ç¬¦ä¸²
 * @param {number} timestamp - æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰
 * @param {string} format - æ ¼å¼ç±»å‹ï¼š'full', 'date', 'time', 'datetime'
 * @returns {string} æ ¼å¼åŒ–çš„æ—¶é—´å­—ç¬¦ä¸²
 */
export const formatBeijingTime = (timestamp, format = 'full')
```

**æ”¯æŒçš„æ ¼å¼**ï¼š
- `'full'`: `2025-10-11 20:45:30` ï¼ˆå®Œæ•´æ—¶é—´ï¼‰
- `'datetime'`: `2025-10-11 20:45` ï¼ˆæ—¥æœŸ+æ—¶é—´ï¼‰
- `'date'`: `2025-10-11` ï¼ˆä»…æ—¥æœŸï¼‰
- `'time'`: `20:45` ï¼ˆä»…æ—¶é—´ï¼‰

**ç”¨é€”**ï¼šé¢‘é“å†…å®¹å‘å¸ƒæ—¶é—´æ˜¾ç¤º

##### formatMessageTime(timestamp)
```javascript
/**
 * æ ¼å¼åŒ–ä¸ºç›¸å¯¹æ—¶é—´ï¼ˆèŠå¤©æ¶ˆæ¯ç”¨ï¼‰
 * @param {number} timestamp - æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰
 * @returns {string} ç›¸å¯¹æ—¶é—´å­—ç¬¦ä¸²
 */
export const formatMessageTime = (timestamp)
```

**æ˜¾ç¤ºè§„åˆ™**ï¼š
- 1åˆ†é’Ÿå†…ï¼š`åˆšåˆš`
- 1å°æ—¶å†…ï¼š`5åˆ†é’Ÿå‰`ã€`30åˆ†é’Ÿå‰`
- 24å°æ—¶å†…ï¼š`14:30`ï¼ˆæ—¶:åˆ†ï¼‰
- è¶…è¿‡24å°æ—¶ï¼š`10æœˆ11æ—¥ 14:30`

**ç”¨é€”**ï¼šèŠå¤©æ¶ˆæ¯æ—¶é—´æ˜¾ç¤º

##### formatConversationTime(timestamp)
```javascript
/**
 * æ ¼å¼åŒ–ä¼šè¯åˆ—è¡¨æ—¶é—´
 * @param {number} timestamp - æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰
 * @returns {string} æ ¼å¼åŒ–çš„æ—¶é—´å­—ç¬¦ä¸²
 */
export const formatConversationTime = (timestamp)
```

**æ˜¾ç¤ºè§„åˆ™**ï¼š
- 24å°æ—¶å†…ï¼š`14:30`ï¼ˆæ—¶:åˆ†ï¼‰
- 7å¤©å†…ï¼š`å‘¨ä¸€`ã€`å‘¨äºŒ`ç­‰
- è¶…è¿‡7å¤©ï¼š`10æœˆ11æ—¥`

**ç”¨é€”**ï¼šæ¶ˆæ¯åˆ—è¡¨æœ€åæ¶ˆæ¯æ—¶é—´æ˜¾ç¤º

### 2. æ›´æ–°é¢‘é“è¯¦æƒ…é¡µé¢

**æ–‡ä»¶**ï¼š`src/screens/ChannelDetailScreen.js`

#### ä¿®æ”¹å†…å®¹

**å¯¼å…¥æ—¶é—´å·¥å…·**ï¼š
```javascript
import { formatBeijingTime } from '../utils/timeUtils';
```

**æ›´æ–°æ—¶é—´æ˜¾ç¤º**ï¼š
```javascript
// ä¿®æ”¹å‰
<Text style={styles.postTime}>
  {new Date(post.timestamp).toLocaleString()}
</Text>

// ä¿®æ”¹å
<Text style={styles.postTime}>
  {formatBeijingTime(post.timestamp, 'datetime')}
</Text>
```

**æ˜¾ç¤ºæ•ˆæœ**ï¼š
- ä¿®æ”¹å‰ï¼šæ ¹æ®è®¾å¤‡æ—¶åŒºæ˜¾ç¤ºï¼Œå¯èƒ½æ˜¯ `2025/10/11 ä¸‹åˆ8:45:30`
- ä¿®æ”¹åï¼šç»Ÿä¸€æ˜¾ç¤ºåŒ—äº¬æ—¶é—´ `2025-10-11 20:45`

### 3. æ›´æ–°èŠå¤©è¯¦æƒ…é¡µé¢

**æ–‡ä»¶**ï¼š`src/screens/ChatDetailScreen.js`

#### ä¿®æ”¹å†…å®¹

**å¯¼å…¥æ—¶é—´å·¥å…·**ï¼š
```javascript
import { formatMessageTime } from '../utils/timeUtils';
```

**åˆ é™¤æœ¬åœ°formatMessageTimeå‡½æ•°**ï¼š
```javascript
// åˆ é™¤äº†çº¦24è¡Œçš„æœ¬åœ°æ—¶é—´æ ¼å¼åŒ–ä»£ç 
// æ”¹ç”¨ç»Ÿä¸€çš„æ—¶é—´å·¥å…·å‡½æ•°
```

**æ›´æ–°æ—¶é—´æ˜¾ç¤º**ï¼š
```javascript
{showTime && (
  <Text style={styles.messageTime}>
    {formatMessageTime(message.timestamp)}
  </Text>
)}
```

**æ˜¾ç¤ºæ•ˆæœ**ï¼š
- 1åˆ†é’Ÿå†…ï¼š`åˆšåˆš`
- 30åˆ†é’Ÿå‰ï¼š`30åˆ†é’Ÿå‰`
- ä»Šå¤©14:30å‘é€ï¼š`14:30`
- æ˜¨å¤©å‘é€ï¼š`10æœˆ10æ—¥ 14:30`

### 4. æ›´æ–°æ¶ˆæ¯åˆ—è¡¨é¡µé¢

**æ–‡ä»¶**ï¼š`src/screens/MessagesScreen.js`

#### ä¿®æ”¹å†…å®¹

**å¯¼å…¥æ—¶é—´å·¥å…·**ï¼š
```javascript
import { formatConversationTime } from '../utils/timeUtils';
```

**åˆ é™¤æœ¬åœ°formatTimeå‡½æ•°**ï¼š
```javascript
// åˆ é™¤äº†çº¦24è¡Œçš„æœ¬åœ°æ—¶é—´æ ¼å¼åŒ–ä»£ç 
// æ”¹ç”¨ç»Ÿä¸€çš„æ—¶é—´å·¥å…·å‡½æ•°
```

**æ›´æ–°æ—¶é—´æ˜¾ç¤º**ï¼š
```javascript
<Text style={styles.messageTime}>
  {formatConversationTime(conversation.lastMessageTime)}
</Text>
```

**æ˜¾ç¤ºæ•ˆæœ**ï¼š
- ä»Šå¤©çš„æ¶ˆæ¯ï¼š`14:30`
- æœ¬å‘¨çš„æ¶ˆæ¯ï¼š`å‘¨ä¸€`ã€`å‘¨äºŒ`ç­‰
- æ›´æ—©çš„æ¶ˆæ¯ï¼š`10æœˆ5æ—¥`

## ğŸ“Š æ—¶é—´è½¬æ¢åŸç†

### æ—¶åŒºè½¬æ¢æµç¨‹

```
è®¾å¤‡æœ¬åœ°æ—¶é—´ï¼ˆä»»æ„æ—¶åŒºï¼‰
    â†“
è·å–æ—¶åŒºåç§»é‡ï¼ˆgetTimezoneOffsetï¼‰
    â†“
è®¡ç®—UTCæ—¶é—´ï¼ˆä¸–ç•Œåè°ƒæ—¶ï¼‰
    â†“
åŠ ä¸Š8å°æ—¶åç§»
    â†“
åŒ—äº¬æ—¶é—´ï¼ˆUTC+8ï¼‰
```

### ä»£ç ç¤ºä¾‹

```javascript
// å‡è®¾è®¾å¤‡åœ¨ç¾å›½ä¸œéƒ¨ï¼ˆUTC-5ï¼‰
const deviceTime = new Date('2025-10-11 07:45:00'); // è®¾å¤‡æ˜¾ç¤ºæ—¶é—´
const offset = deviceTime.getTimezoneOffset(); // -300ï¼ˆåˆ†é’Ÿï¼‰
const utcTime = deviceTime.getTime() + (offset * 60000); // UTCæ—¶é—´
const beijingTime = new Date(utcTime + (8 * 3600000)); // UTC+8

// ç»“æœï¼š
// è®¾å¤‡æœ¬åœ°æ—¶é—´ï¼š2025-10-11 07:45:00 (UTC-5)
// UTCæ—¶é—´ï¼š2025-10-11 12:45:00 (UTC)
// åŒ—äº¬æ—¶é—´ï¼š2025-10-11 20:45:00 (UTC+8)
```

## ğŸ¯ ä¼˜åŒ–æ•ˆæœ

### ä¿®æ”¹å‰çš„é—®é¢˜

1. **æ—¶åŒºä¸ä¸€è‡´**
   - ä¸åŒåœ°åŒºç”¨æˆ·çœ‹åˆ°çš„æ—¶é—´ä¸åŒ
   - ç¾å›½ç”¨æˆ·çœ‹åˆ°çš„æ˜¯ç¾å›½æ—¶é—´
   - æ¬§æ´²ç”¨æˆ·çœ‹åˆ°çš„æ˜¯æ¬§æ´²æ—¶é—´

2. **æ—¶é—´æ ¼å¼æ··ä¹±**
   - ä½¿ç”¨ç³»ç»Ÿé»˜è®¤æ ¼å¼
   - ä¸åŒè¯­è¨€ç¯å¢ƒæ ¼å¼ä¸åŒ
   - æ˜¾ç¤ºæ•ˆæœä¸ç»Ÿä¸€

3. **ä»£ç é‡å¤**
   - æ¯ä¸ªé¡µé¢éƒ½æœ‰è‡ªå·±çš„æ ¼å¼åŒ–å‡½æ•°
   - é€»è¾‘é‡å¤ï¼Œéš¾ä»¥ç»´æŠ¤
   - æ ¼å¼ä¸ç»Ÿä¸€

### ä¿®æ”¹åçš„ä¼˜åŠ¿

1. **æ—¶é—´ç»Ÿä¸€** âœ…
   - æ‰€æœ‰ç”¨æˆ·çœ‹åˆ°ç›¸åŒçš„åŒ—äº¬æ—¶é—´
   - æ— è®ºç”¨æˆ·åœ¨å“ªä¸ªæ—¶åŒº
   - æ—¶é—´æ˜¾ç¤ºä¸€è‡´å¯é 

2. **æ ¼å¼ç»Ÿä¸€** âœ…
   - ç»Ÿä¸€çš„æ—¶é—´æ ¼å¼
   - æ¸…æ™°æ˜“è¯»
   - ç¬¦åˆä¸­å›½ç”¨æˆ·ä¹ æƒ¯

3. **ä»£ç ç®€æ´** âœ…
   - ç»Ÿä¸€çš„æ—¶é—´å·¥å…·å‡½æ•°
   - å‡å°‘ä»£ç é‡å¤
   - æ˜“äºç»´æŠ¤å’Œæ‰©å±•

## ğŸ“± ä½¿ç”¨ç¤ºä¾‹

### åœ¨æ–°é¡µé¢ä¸­ä½¿ç”¨

```javascript
import { 
  formatBeijingTime, 
  formatMessageTime, 
  formatConversationTime 
} from '../utils/timeUtils';

// é¢‘é“å‘å¸ƒæ—¶é—´
const postTime = formatBeijingTime(timestamp, 'datetime');
// æ˜¾ç¤ºï¼š2025-10-11 20:45

// èŠå¤©æ¶ˆæ¯æ—¶é—´
const messageTime = formatMessageTime(timestamp);
// æ˜¾ç¤ºï¼šåˆšåˆš / 5åˆ†é’Ÿå‰ / 14:30 / 10æœˆ11æ—¥ 14:30

// ä¼šè¯åˆ—è¡¨æ—¶é—´
const conversationTime = formatConversationTime(timestamp);
// æ˜¾ç¤ºï¼š14:30 / å‘¨ä¸€ / 10æœˆ5æ—¥
```

## ğŸ§ª æµ‹è¯•éªŒè¯

### æµ‹è¯•åœºæ™¯1ï¼šå‘å¸ƒé¢‘é“å†…å®¹
```
æ“ä½œæ­¥éª¤ï¼š
1. ç™»å½•ç®¡ç†å‘˜è´¦æˆ·
2. è¿›å…¥å·²åˆ›å»ºçš„é¢‘é“
3. å‘å¸ƒä¸€æ¡æ–‡å­—å†…å®¹
4. æŸ¥çœ‹å‘å¸ƒæ—¶é—´æ˜¾ç¤º

é¢„æœŸç»“æœï¼š
âœ… æ˜¾ç¤ºå½“å‰åŒ—äº¬æ—¶é—´ï¼Œæ ¼å¼ï¼š2025-10-11 20:45
âœ… ä¸å—è®¾å¤‡æ—¶åŒºå½±å“
```

### æµ‹è¯•åœºæ™¯2ï¼šå‘é€èŠå¤©æ¶ˆæ¯
```
æ“ä½œæ­¥éª¤ï¼š
1. ä¸å…¶ä»–ç”¨æˆ·èŠå¤©
2. å‘é€å‡ æ¡æ¶ˆæ¯
3. æŸ¥çœ‹æ¶ˆæ¯æ—¶é—´æ˜¾ç¤º

é¢„æœŸç»“æœï¼š
âœ… åˆšå‘é€çš„æ˜¾ç¤º"åˆšåˆš"
âœ… å‡ åˆ†é’Ÿå‰çš„æ˜¾ç¤º"Xåˆ†é’Ÿå‰"
âœ… ä»Šå¤©çš„æ˜¾ç¤ºæ—¶é—´"14:30"
âœ… æ˜¨å¤©çš„æ˜¾ç¤ºæ—¥æœŸ+æ—¶é—´
```

### æµ‹è¯•åœºæ™¯3ï¼šæ¶ˆæ¯åˆ—è¡¨
```
æ“ä½œæ­¥éª¤ï¼š
1. æŸ¥çœ‹æ¶ˆæ¯åˆ—è¡¨
2. è§‚å¯Ÿæœ€åæ¶ˆæ¯æ—¶é—´

é¢„æœŸç»“æœï¼š
âœ… ä»Šå¤©çš„å¯¹è¯æ˜¾ç¤ºæ—¶é—´
âœ… æœ¬å‘¨çš„å¯¹è¯æ˜¾ç¤ºæ˜ŸæœŸ
âœ… æ›´æ—©çš„å¯¹è¯æ˜¾ç¤ºæ—¥æœŸ
```

## ğŸ“‹ ä¿®æ”¹æ–‡ä»¶æ¸…å•

| æ–‡ä»¶ | ç±»å‹ | ä¿®æ”¹å†…å®¹ |
|------|------|----------|
| `src/utils/timeUtils.js` | æ–°å¢ | åˆ›å»ºæ—¶é—´å·¥å…·å‡½æ•° |
| `src/screens/ChannelDetailScreen.js` | ä¿®æ”¹ | ä½¿ç”¨formatBeijingTime |
| `src/screens/ChatDetailScreen.js` | ä¿®æ”¹ | ä½¿ç”¨formatMessageTime |
| `src/screens/MessagesScreen.js` | ä¿®æ”¹ | ä½¿ç”¨formatConversationTime |

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. æ—¶é—´æˆ³æ¥æº
- æ‰€æœ‰æ—¶é—´æˆ³ä½¿ç”¨`Date.now()`ç”Ÿæˆ
- ç”Ÿæˆçš„æ—¶é—´æˆ³æ˜¯UTCæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
- è½¬æ¢ä¸ºåŒ—äº¬æ—¶é—´ä»…ç”¨äºæ˜¾ç¤º

### 2. æœåŠ¡å™¨æ—¶é—´
- å½“å‰æ˜¯å‰ç«¯æ¨¡æ‹Ÿæ•°æ®
- å®é™…é¡¹ç›®ä¸­åº”ä½¿ç”¨æœåŠ¡å™¨æ—¶é—´
- é¿å…å®¢æˆ·ç«¯æ—¶é—´ä¸å‡†ç¡®çš„é—®é¢˜

### 3. æ—¶åŒºè½¬æ¢
- `getTimezoneOffset()`è¿”å›çš„æ˜¯åˆ†é’Ÿ
- éœ€è¦ä¹˜ä»¥60000è½¬æ¢ä¸ºæ¯«ç§’
- åŒ—äº¬æ—¶é—´æ˜¯UTC+8ï¼ˆ8å°æ—¶ = 28800000æ¯«ç§’ï¼‰

### 4. æ˜¾ç¤ºæ ¼å¼
- ä½¿ç”¨ç»Ÿä¸€çš„æ ¼å¼åŒ–å‡½æ•°
- é¿å…ç›´æ¥ä½¿ç”¨`toLocaleString()`
- ç¡®ä¿æ‰€æœ‰ç”¨æˆ·çœ‹åˆ°ç›¸åŒæ ¼å¼

## ğŸ”„ åç»­æ‰©å±•

### 1. æ”¯æŒæ›´å¤šæ—¶åŒº
```javascript
export const formatTime = (timestamp, timezone = 'Asia/Shanghai') => {
  // æ”¯æŒå¤šæ—¶åŒºè½¬æ¢
  // 'Asia/Shanghai' - åŒ—äº¬
  // 'America/New_York' - çº½çº¦
  // 'Europe/London' - ä¼¦æ•¦
};
```

### 2. å›½é™…åŒ–æ”¯æŒ
```javascript
export const formatTime = (timestamp, locale = 'zh-CN') => {
  // æ”¯æŒå¤šè¯­è¨€æ˜¾ç¤º
  // 'zh-CN' - ä¸­æ–‡
  // 'en-US' - è‹±æ–‡
  // 'ja-JP' - æ—¥æ–‡
};
```

### 3. è‡ªå®šä¹‰æ ¼å¼
```javascript
export const formatCustomTime = (timestamp, customFormat) => {
  // æ”¯æŒè‡ªå®šä¹‰æ ¼å¼å­—ç¬¦ä¸²
  // 'YYYY-MM-DD HH:mm:ss'
  // 'MM/DD/YYYY HH:mm'
};
```

## âœ… å®ŒæˆçŠ¶æ€

- âœ… åˆ›å»ºæ—¶é—´å·¥å…·æ–‡ä»¶
- âœ… å®ç°åŒ—äº¬æ—¶é—´è½¬æ¢
- âœ… æ›´æ–°é¢‘é“è¯¦æƒ…é¡µé¢
- âœ… æ›´æ–°èŠå¤©è¯¦æƒ…é¡µé¢
- âœ… æ›´æ–°æ¶ˆæ¯åˆ—è¡¨é¡µé¢
- âœ… åˆ é™¤é‡å¤ä»£ç 
- âœ… ä»£ç è¯­æ³•æ£€æŸ¥é€šè¿‡
- âœ… æ— é”™è¯¯æˆ–è­¦å‘Š

## ğŸ‰ æ€»ç»“

é€šè¿‡ç»Ÿä¸€çš„æ—¶é—´å·¥å…·å‡½æ•°ï¼ŒæˆåŠŸå°†åº”ç”¨çš„æ‰€æœ‰æ—¶é—´æ˜¾ç¤ºè½¬æ¢ä¸ºåŒ—äº¬æ—¶é—´ï¼ˆUTC+8ï¼‰ï¼Œè§£å†³äº†æ—¶åŒºä¸ä¸€è‡´çš„é—®é¢˜ï¼Œæå‡äº†ç”¨æˆ·ä½“éªŒã€‚

**ä¸»è¦æ”¹è¿›**ï¼š
1. âœ… æ—¶é—´æ˜¾ç¤ºç»Ÿä¸€ä¸ºåŒ—äº¬æ—¶é—´
2. âœ… æ ¼å¼åŒ–é€»è¾‘ç»Ÿä¸€ç®¡ç†
3. âœ… ä»£ç ç»“æ„æ›´æ¸…æ™°
4. âœ… æ˜“äºç»´æŠ¤å’Œæ‰©å±•

---

**æ›´æ–°æ—¶é—´**ï¼š2025-10-11  
**ç‰ˆæœ¬**ï¼š1.0  
**çŠ¶æ€**ï¼šâœ… å·²å®Œæˆå¹¶æµ‹è¯•é€šè¿‡
